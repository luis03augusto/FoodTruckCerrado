@model FoodTruckCerrado.Models.LocalizacaoFood

<section class="container">
    <div class="cabecalho-mapa">
        <h2>Cadastro de localização.</h2>
        <p>Para cadastrar uma nova localização basta selecionar no mapa abaixo o local desejado para.</p>
        <p>Sera necessario prencher apenas as campos descrição, data e RA</p>
    </div>
    <div id="map">

    </div>
    <div class="formulario-mapa">
        @using (Html.BeginForm("Form", "LocalizacaoFood", FormMethod.Post))
        {
            @Html.HiddenFor(l => l.FoodTruckId)

            @Html.LabelFor(l => l.Descricao, "Descrição:")
            @Html.TextAreaFor(l => l.Descricao, new { @class = "form-control" })

            @Html.LabelFor(l => l.Latitude, "Latitude:")
            @Html.TextBoxFor(l => l.Latitude, new { @id = "latitude", @class = "form-control" })

            @Html.LabelFor(l => l.Logitude, "Longitude:")
            @Html.TextBoxFor(l => l.Logitude, new { @id = "longitude", @class = "form-control" })

            @Html.LabelFor(l => l.DataLocalização, "Longitude:")
            @Html.TextBoxFor(l => l.DataLocalização, new { @id = "longitude", @class = "form-control" })

            <input class="btn btn-primary" type="submit" value="Salvar" />
        }
    </div>      
</section>

<script>
    var map;
    var mark;
    function mostraLocalizacao(posicao) {

        var latitude = posicao.coords.latitude;
        var longitude = posicao.coords.longitude;

        mostrarMapa(posicao.coords);
    }

    function mostrarMapa(coords) {

        var googleLatLong = new google.maps.LatLng(coords.latitude, coords.longitude);
        var mapaOpcao =
            {
                zoom: 15,
                center: googleLatLong,
                mapTypeId: google.maps.MapTypeId.ROAMAP
            };

        var mapDiv = document.getElementById("map");
        map = new google.maps.Map(mapDiv, mapaOpcao);

        google.maps.event.addListener(map, "click", function (event) {


            var latitude = event.latLng.lat();
            var longitude = event.latLng.lng();

            var latitudeLoc = document.getElementById("latitude");
            latitudeLoc.value = latitude;
            var longitudeLoc = document.getElementById("longitude");
            longitudeLoc.value = longitude;
            map.panTo(event.latLng);

            criarMarker(event.latLng);

        });
    }

    function criarMarker(latLng) {
        if (mark) {
            mark.setPosition(latLng);
        }
        else {
            mark = new google.maps.Marker(
                {
                    position: latLng,
                    map: map,
                    clickable: true
                });
        }

        google.maps.event.addListener(map, 'click', function (event) {
            criarMarker(event.latLng);
        });
    }

    window.onload = function () {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(mostraLocalizacao);
        } else {
            alert("Desculpe, Este navegado não suporta geolocalização");
        }
    }
</script>